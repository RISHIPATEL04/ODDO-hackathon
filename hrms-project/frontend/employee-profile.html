<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile - HR Management System</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/profile.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <i class="fas fa-users"></i>
                <h2>HRMS</h2>
            </div>
            
            <div class="user-info">
                <div class="avatar" id="profileAvatar">
                    <i class="fas fa-user" id="avatarIcon"></i>
                </div>
                <h3 id="userName">Employee Name</h3>
                <p id="userRole">Employee</p>
                <p id="userEmpId">EMP001</p>
            </div>
            
            <nav class="sidebar-nav">
                <a href="employee-dashboard.html">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </a>
                <a href="employee-profile.html" class="active">
                    <i class="fas fa-user"></i> My Profile
                </a>
                <a href="attendance.html">
                    <i class="fas fa-calendar-check"></i> Attendance
                </a>
                <a href="leave.html">
                    <i class="fas fa-calendar-alt"></i> Leave Management
                </a>
                <a href="payroll.html">
                    <i class="fas fa-file-invoice-dollar"></i> Payroll
                </a>
                <a href="#" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </a>
            </nav>
        </aside>
        
        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <h1>My Profile</h1>
                <div class="header-actions">
                    <button class="btn btn-secondary" onclick="window.print()">
                        <i class="fas fa-print"></i> Print
                    </button>
                    <button class="btn btn-primary" id="editProfileBtn">
                        <i class="fas fa-edit"></i> Edit Profile
                    </button>
                </div>
            </header>
            
            <!-- Profile Tabs -->
            <div class="profile-tabs">
                <button class="tab-btn active" data-tab="personal">Personal Details</button>
                <button class="tab-btn" data-tab="job">Job Details</button>
                <button class="tab-btn" data-tab="salary">Salary Structure</button>
                <button class="tab-btn" data-tab="documents">Documents</button>
            </div>
            
            <!-- Personal Details Tab -->
            <div id="personalTab" class="tab-content active">
                <div class="profile-section">
                    <div class="profile-header">
                        <h2>Personal Information</h2>
                        <button class="btn btn-outline" onclick="editSection('personal')">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                    </div>
                    
                    <div class="profile-grid">
                        <div class="profile-avatar-section">
                            <div class="avatar-large" id="largeAvatar">
                                <i class="fas fa-user" id="largeAvatarIcon"></i>
                                <div class="avatar-overlay" onclick="triggerAvatarUpload()">
                                    <i class="fas fa-camera"></i>
                                    <span>Change Photo</span>
                                </div>
                            </div>
                            <input type="file" id="avatarUpload" accept="image/*" style="display: none;">
                            <p class="avatar-hint">Click on the photo to upload a new one</p>
                        </div>
                        
                        <div class="profile-details">
                            <div class="detail-row">
                                <div class="detail-item">
                                    <label>Employee ID</label>
                                    <p id="profileEmpId">EMP001</p>
                                </div>
                                <div class="detail-item">
                                    <label>Email Address</label>
                                    <p id="profileEmail">employee@company.com</p>
                                </div>
                            </div>
                            
                            <div class="detail-row">
                                <div class="detail-item">
                                    <label>Full Name</label>
                                    <p id="profileFullName">John Doe</p>
                                </div>
                                <div class="detail-item">
                                    <label>Date of Birth</label>
                                    <p id="profileDob">January 15, 1990</p>
                                </div>
                            </div>
                            
                            <div class="detail-row">
                                <div class="detail-item">
                                    <label>Phone Number</label>
                                    <p id="profilePhone">+1 (555) 123-4567</p>
                                </div>
                                <div class="detail-item">
                                    <label>Emergency Contact</label>
                                    <p id="profileEmergency">Jane Doe - +1 (555) 987-6543</p>
                                </div>
                            </div>
                            
                            <div class="detail-row">
                                <div class="detail-item full-width">
                                    <label>Address</label>
                                    <p id="profileAddress">123 Main Street, Apt 4B, New York, NY 10001, United States</p>
                                </div>
                            </div>
                            
                            <div class="detail-row">
                                <div class="detail-item">
                                    <label>Gender</label>
                                    <p id="profileGender">Male</p>
                                </div>
                                <div class="detail-item">
                                    <label>Marital Status</label>
                                    <p id="profileMarital">Married</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="profile-section">
                    <div class="profile-header">
                        <h2>Contact Information</h2>
                        <button class="btn btn-outline" onclick="editSection('contact')">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                    </div>
                    
                    <div class="contact-grid">
                        <div class="contact-item">
                            <div class="contact-icon">
                                <i class="fas fa-envelope"></i>
                            </div>
                            <div class="contact-info">
                                <label>Email</label>
                                <p id="contactEmail">john.doe@company.com</p>
                            </div>
                        </div>
                        
                        <div class="contact-item">
                            <div class="contact-icon">
                                <i class="fas fa-phone"></i>
                            </div>
                            <div class="contact-info">
                                <label>Work Phone</label>
                                <p id="contactWorkPhone">+1 (555) 123-4567 ext. 123</p>
                            </div>
                        </div>
                        
                        <div class="contact-item">
                            <div class="contact-icon">
                                <i class="fas fa-mobile-alt"></i>
                            </div>
                            <div class="contact-info">
                                <label>Personal Phone</label>
                                <p id="contactPersonalPhone">+1 (555) 987-6543</p>
                            </div>
                        </div>
                        
                        <div class="contact-item">
                            <div class="contact-icon">
                                <i class="fas fa-map-marker-alt"></i>
                            </div>
                            <div class="contact-info">
                                <label>Work Location</label>
                                <p id="contactLocation">New York Office - Floor 15</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Job Details Tab -->
            <div id="jobTab" class="tab-content">
                <div class="profile-section">
                    <div class="profile-header">
                        <h2>Employment Details</h2>
                        <button class="btn btn-outline" onclick="editSection('employment')">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                    </div>
                    
                    <div class="detail-grid">
                        <div class="detail-item">
                            <label>Employee ID</label>
                            <p id="jobEmpId">EMP001</p>
                        </div>
                        <div class="detail-item">
                            <label>Employee Type</label>
                            <p id="jobType">Full-time</p>
                        </div>
                        <div class="detail-item">
                            <label>Department</label>
                            <p id="jobDepartment">Engineering</p>
                        </div>
                        <div class="detail-item">
                            <label>Designation</label>
                            <p id="jobDesignation">Senior Software Engineer</p>
                        </div>
                        <div class="detail-item">
                            <label>Reporting Manager</label>
                            <p id="jobManager">Sarah Johnson</p>
                        </div>
                        <div class="detail-item">
                            <label>Team</label>
                            <p id="jobTeam">Backend Development</p>
                        </div>
                        <div class="detail-item">
                            <label>Date of Joining</label>
                            <p id="jobJoinDate">June 15, 2020</p>
                        </div>
                        <div class="detail-item">
                            <label>Years of Service</label>
                            <p id="jobServiceYears">3 years, 6 months</p>
                        </div>
                        <div class="detail-item">
                            <label>Work Schedule</label>
                            <p id="jobSchedule">Monday-Friday, 9:00 AM - 6:00 PM</p>
                        </div>
                        <div class="detail-item">
                            <label>Employment Status</label>
                            <span class="status-badge active" id="jobStatus">Active</span>
                        </div>
                    </div>
                </div>
                
                <div class="profile-section">
                    <div class="profile-header">
                        <h2>Skills & Qualifications</h2>
                        <button class="btn btn-outline" onclick="editSection('skills')">
                            <i class="fas fa-plus"></i> Add Skills
                        </button>
                    </div>
                    
                    <div class="skills-section">
                        <div class="skills-category">
                            <h3>Technical Skills</h3>
                            <div class="skills-list" id="technicalSkills">
                                <span class="skill-tag">JavaScript</span>
                                <span class="skill-tag">Node.js</span>
                                <span class="skill-tag">React</span>
                                <span class="skill-tag">MongoDB</span>
                                <span class="skill-tag">AWS</span>
                                <span class="skill-tag">Docker</span>
                            </div>
                        </div>
                        
                        <div class="skills-category">
                            <h3>Certifications</h3>
                            <div class="certifications-list" id="certifications">
                                <div class="certification-item">
                                    <h4>AWS Certified Solutions Architect</h4>
                                    <p>Amazon Web Services • Issued: 2022 • Valid until: 2025</p>
                                </div>
                                <div class="certification-item">
                                    <h4>Google Cloud Professional Developer</h4>
                                    <p>Google Cloud • Issued: 2021 • Valid until: 2024</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Salary Structure Tab -->
            <div id="salaryTab" class="tab-content">
                <div class="profile-section">
                    <div class="profile-header">
                        <h2>Salary Structure</h2>
                        <button class="btn btn-outline" onclick="downloadSalarySlip()">
                            <i class="fas fa-download"></i> Download Salary Slip
                        </button>
                    </div>
                    
                    <div class="salary-overview">
                        <div class="salary-card">
                            <div class="salary-icon">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <div class="salary-info">
                                <label>Monthly Gross Salary</label>
                                <h3 id="grossSalary">$6,500.00</h3>
                            </div>
                        </div>
                        
                        <div class="salary-card">
                            <div class="salary-icon">
                                <i class="fas fa-hand-holding-usd"></i>
                            </div>
                            <div class="salary-info">
                                <label>Monthly Net Salary</label>
                                <h3 id="netSalary">$5,200.00</h3>
                            </div>
                        </div>
                        
                        <div class="salary-card">
                            <div class="salary-icon">
                                <i class="fas fa-calendar-alt"></i>
                            </div>
                            <div class="salary-info">
                                <label>Payment Date</label>
                                <h3 id="paymentDate">25th of each month</h3>
                            </div>
                        </div>
                    </div>
                    
                    <div class="salary-details">
                        <div class="salary-breakdown">
                            <h3>Earnings</h3>
                            <table class="salary-table">
                                <tr>
                                    <td>Basic Salary</td>
                                    <td id="basicSalary">$4,000.00</td>
                                </tr>
                                <tr>
                                    <td>House Rent Allowance</td>
                                    <td id="hra">$1,000.00</td>
                                </tr>
                                <tr>
                                    <td>Travel Allowance</td>
                                    <td id="ta">$500.00</td>
                                </tr>
                                <tr>
                                    <td>Medical Allowance</td>
                                    <td id="ma">$300.00</td>
                                </tr>
                                <tr>
                                    <td>Performance Bonus</td>
                                    <td id="bonus">$700.00</td>
                                </tr>
                                <tr class="total-row">
                                    <td><strong>Total Earnings</strong></td>
                                    <td><strong id="totalEarnings">$6,500.00</strong></td>
                                </tr>
                            </table>
                        </div>
                        
                        <div class="salary-breakdown">
                            <h3>Deductions</h3>
                            <table class="salary-table">
                                <tr>
                                    <td>Income Tax</td>
                                    <td id="incomeTax">$800.00</td>
                                </tr>
                                <tr>
                                    <td>Provident Fund</td>
                                    <td id="pf">$400.00</td>
                                </tr>
                                <tr>
                                    <td>Health Insurance</td>
                                    <td id="insurance">$100.00</td>
                                </tr>
                                <tr>
                                    <td>Professional Tax</td>
                                    <td id="pt">$200.00</td>
                                </tr>
                                <tr class="total-row">
                                    <td><strong>Total Deductions</strong></td>
                                    <td><strong id="totalDeductions">$1,500.00</strong></td>
                                </tr>
                                <tr class="net-salary-row">
                                    <td><strong>Net Salary</strong></td>
                                    <td><strong id="finalNetSalary">$5,200.00</strong></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    
                    <div class="salary-history">
                        <h3>Recent Salary History</h3>
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Month</th>
                                        <th>Basic Salary</th>
                                        <th>Allowances</th>
                                        <th>Deductions</th>
                                        <th>Net Salary</th>
                                        <th>Status</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="salaryHistory">
                                    <!-- Data will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Documents Tab -->
            <div id="documentsTab" class="tab-content">
                <div class="profile-section">
                    <div class="profile-header">
                        <h2>Documents</h2>
                        <button class="btn btn-primary" onclick="uploadDocument()">
                            <i class="fas fa-upload"></i> Upload Document
                        </button>
                    </div>
                    
                    <div class="documents-grid">
                        <div class="document-card">
                            <div class="document-icon">
                                <i class="fas fa-file-contract"></i>
                            </div>
                            <div class="document-info">
                                <h3>Employment Contract</h3>
                                <p>Signed employment agreement</p>
                                <div class="document-meta">
                                    <span><i class="fas fa-calendar"></i> Uploaded: June 15, 2020</span>
                                    <span><i class="fas fa-file-pdf"></i> PDF • 2.4 MB</span>
                                </div>
                            </div>
                            <div class="document-actions">
                                <button class="btn-icon" title="View">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn-icon" title="Download">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="document-card">
                            <div class="document-icon">
                                <i class="fas fa-id-card"></i>
                            </div>
                            <div class="document-info">
                                <h3>ID Proof</h3>
                                <p>Government issued ID card</p>
                                <div class="document-meta">
                                    <span><i class="fas fa-calendar"></i> Uploaded: June 20, 2020</span>
                                    <span><i class="fas fa-file-image"></i> JPEG • 1.8 MB</span>
                                </div>
                            </div>
                            <div class="document-actions">
                                <button class="btn-icon" title="View">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn-icon" title="Download">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="document-card">
                            <div class="document-icon">
                                <i class="fas fa-graduation-cap"></i>
                            </div>
                            <div class="document-info">
                                <h3>Educational Certificates</h3>
                                <p>Degree and academic certificates</p>
                                <div class="document-meta">
                                    <span><i class="fas fa-calendar"></i> Uploaded: June 18, 2020</span>
                                    <span><i class="fas fa-file-pdf"></i> PDF • 5.2 MB</span>
                                </div>
                            </div>
                            <div class="document-actions">
                                <button class="btn-icon" title="View">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn-icon" title="Download">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="document-card">
                            <div class="document-icon">
                                <i class="fas fa-file-medical"></i>
                            </div>
                            <div class="document-info">
                                <h3>Medical Records</h3>
                                <p>Health insurance and medical history</p>
                                <div class="document-meta">
                                    <span><i class="fas fa-calendar"></i> Uploaded: July 5, 2021</span>
                                    <span><i class="fas fa-file-pdf"></i> PDF • 3.1 MB</span>
                                </div>
                            </div>
                            <div class="document-actions">
                                <button class="btn-icon" title="View">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn-icon" title="Download">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="empty-state" id="noDocuments" style="display: none;">
                        <i class="fas fa-folder-open"></i>
                        <h3>No Documents Uploaded</h3>
                        <p>Upload your documents to keep them organized and accessible</p>
                        <button class="btn btn-primary" onclick="uploadDocument()">
                            <i class="fas fa-upload"></i> Upload Your First Document
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Edit Profile Modal -->
            <div id="editModal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 id="editModalTitle">Edit Personal Details</h2>
                        <button class="modal-close" onclick="closeEditModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="editForm">
                            <div id="editFormContent">
                                <!-- Form content will be dynamically loaded -->
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" onclick="closeEditModal()">
                                    Cancel
                                </button>
                                <button type="submit" class="btn btn-primary" id="saveChangesBtn">
                                    Save Changes
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Document Upload Modal -->
            <div id="uploadModal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>Upload Document</h2>
                        <button class="modal-close" onclick="closeUploadModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="uploadForm">
                            <div class="form-group">
                                <label for="documentType">Document Type</label>
                                <select id="documentType" name="documentType" required>
                                    <option value="">Select document type</option>
                                    <option value="contract">Employment Contract</option>
                                    <option value="id">ID Proof</option>
                                    <option value="education">Educational Certificate</option>
                                    <option value="medical">Medical Record</option>
                                    <option value="experience">Experience Letter</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="documentName">Document Name</label>
                                <input type="text" id="documentName" name="documentName" 
                                       placeholder="Enter document name" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="documentDescription">Description</label>
                                <textarea id="documentDescription" name="documentDescription" 
                                          placeholder="Enter document description" rows="3"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="documentFile">Upload File</label>
                                <div class="file-upload">
                                    <input type="file" id="documentFile" name="documentFile" 
                                           accept=".pdf,.jpg,.jpeg,.png,.doc,.docx" required>
                                    <div class="upload-area" id="uploadArea">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                        <p>Click to browse or drag and drop files here</p>
                                        <small>Supported formats: PDF, JPG, PNG, DOC, DOCX (Max: 10MB)</small>
                                    </div>
                                    <div id="filePreview" class="file-preview"></div>
                                </div>
                            </div>
                            
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" onclick="closeUploadModal()">
                                    Cancel
                                </button>
                                <button type="submit" class="btn btn-primary">
                                    Upload Document
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="js/auth.js"></script>
    <script src="js/profile.js"></script>
    <script>
        // Initialize the profile page
        document.addEventListener('DOMContentLoaded', function() {
            // Check authentication
            const token = localStorage.getItem('token');
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            
            if (!token) {
                window.location.href = 'login.html';
                return;
            }
            
            // Set up event listeners
            setupEventListeners();
            
            // Load profile data
            loadProfileData();
            
            // Load salary data
            loadSalaryData();
            
            // Check URL parameters for admin mode
            const urlParams = new URLSearchParams(window.location.search);
            const isAdminMode = urlParams.get('admin') === 'true';
            
            if (isAdminMode && user.role === 'admin') {
                // Update sidebar for admin
                document.querySelector('.sidebar-nav').innerHTML = `
                    <a href="admin-dashboard.html">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </a>
                    <a href="admin-employees.html">
                        <i class="fas fa-users-cog"></i> Employees
                    </a>
                    <a href="employee-profile.html?admin=true" class="active">
                        <i class="fas fa-user"></i> My Profile
                    </a>
                    <a href="attendance.html?admin=true">
                        <i class="fas fa-calendar-check"></i> Attendance
                    </a>
                    <a href="admin-leave-approval.html">
                        <i class="fas fa-calendar-alt"></i> Leave Approval
                    </a>
                    <a href="admin-payroll.html">
                        <i class="fas fa-file-invoice-dollar"></i> Payroll
                    </a>
                    <a href="#" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </a>
                `;
            }
        });
        
        function setupEventListeners() {
            // Tab switching
            document.querySelectorAll('.tab-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    switchTab(tabId);
                });
            });
            
            // Logout button
            document.getElementById('logoutBtn').addEventListener('click', function() {
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                window.location.href = 'login.html';
            });
            
            // Edit profile button
            document.getElementById('editProfileBtn').addEventListener('click', function() {
                editSection('personal');
            });
            
            // Avatar upload
            document.getElementById('avatarUpload').addEventListener('change', function(e) {
                handleAvatarUpload(e.target.files[0]);
            });
            
            // File upload
            document.getElementById('documentFile').addEventListener('change', function(e) {
                handleFileUpload(e.target.files[0]);
            });
            
            // Drag and drop for file upload
            const uploadArea = document.getElementById('uploadArea');
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', function() {
                this.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('dragover');
                const file = e.dataTransfer.files[0];
                if (file) {
                    document.getElementById('documentFile').files = e.dataTransfer.files;
                    handleFileUpload(file);
                }
            });
            
            // Click upload area to trigger file input
            uploadArea.addEventListener('click', function() {
                document.getElementById('documentFile').click();
            });
            
            // Edit form submission
            document.getElementById('editForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveProfileChanges();
            });
            
            // Upload form submission
            document.getElementById('uploadForm').addEventListener('submit', function(e) {
                e.preventDefault();
                submitDocumentUpload();
            });
        }
        
        function switchTab(tabId) {
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.tab-btn[data-tab="${tabId}"]`).classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tabId}Tab`).classList.add('active');
        }
        
        async function loadProfileData() {
            try {
                const user = JSON.parse(localStorage.getItem('user') || '{}');
                
                // Get full user data from API
                const response = await API.getUserById(user.id);
                
                if (response) {
                    updateProfileDisplay(response);
                }
            } catch (error) {
                console.error('Error loading profile data:', error);
                // Fallback to localStorage data
                const user = JSON.parse(localStorage.getItem('user') || '{}');
                updateProfileDisplay(user);
            }
        }
        
        function updateProfileDisplay(userData) {
            const personal = userData.personalDetails || {};
            const job = userData.jobDetails || {};
            const salary = userData.salaryStructure || {};
            
            // Set user info in sidebar
            document.getElementById('userName').textContent = 
                `${personal.firstName || ''} ${personal.lastName || ''}`.trim() || 'Employee Name';
            document.getElementById('userRole').textContent = userData.role === 'admin' ? 'Administrator' : 'Employee';
            document.getElementById('userEmpId').textContent = userData.employeeId || 'EMP001';
            
            // Set avatar initials
            const initials = (personal.firstName?.charAt(0) || '') + (personal.lastName?.charAt(0) || '');
            if (initials) {
                document.getElementById('avatarIcon').textContent = initials;
                document.getElementById('largeAvatarIcon').textContent = initials;
            }
            
            // Personal details
            document.getElementById('profileEmpId').textContent = userData.employeeId || 'EMP001';
            document.getElementById('profileEmail').textContent = userData.email || 'employee@company.com';
            document.getElementById('profileFullName').textContent = 
                `${personal.firstName || ''} ${personal.lastName || ''}`.trim() || 'John Doe';
            
            if (personal.dateOfBirth) {
                const dob = new Date(personal.dateOfBirth);
                document.getElementById('profileDob').textContent = 
                    dob.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
            }
            
            document.getElementById('profilePhone').textContent = personal.phone || '+1 (555) 123-4567';
            document.getElementById('profileAddress').textContent = personal.address || '123 Main Street, New York, NY 10001';
            document.getElementById('profileGender').textContent = personal.gender || 'Male';
            document.getElementById('profileMarital').textContent = personal.maritalStatus || 'Single';
            
            // Contact info
            document.getElementById('contactEmail').textContent = userData.email || 'john.doe@company.com';
            document.getElementById('contactWorkPhone').textContent = job.workPhone || '+1 (555) 123-4567 ext. 123';
            
            // Job details
            document.getElementById('jobEmpId').textContent = userData.employeeId || 'EMP001';
            document.getElementById('jobType').textContent = job.employmentType || 'Full-time';
            document.getElementById('jobDepartment').textContent = job.department || 'Engineering';
            document.getElementById('jobDesignation').textContent = job.position || 'Software Engineer';
            
            if (job.dateOfJoining) {
                const joinDate = new Date(job.dateOfJoining);
                document.getElementById('jobJoinDate').textContent = 
                    joinDate.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
                
                // Calculate years of service
                const today = new Date();
                const years = today.getFullYear() - joinDate.getFullYear();
                const months = today.getMonth() - joinDate.getMonth();
                let serviceYears = '';
                
                if (years > 0) {
                    serviceYears += `${years} year${years > 1 ? 's' : ''}`;
                }
                if (months > 0) {
                    if (serviceYears) serviceYears += ', ';
                    serviceYears += `${months} month${months > 1 ? 's' : ''}`;
                }
                
                document.getElementById('jobServiceYears').textContent = serviceYears || 'New employee';
            }
        }
        
        async function loadSalaryData() {
            try {
                const response = await API.getMyPayroll();
                
                if (response && response.length > 0) {
                    const latestPayroll = response[0];
                    updateSalaryDisplay(latestPayroll);
                    populateSalaryHistory(response);
                }
            } catch (error) {
                console.error('Error loading salary data:', error);
            }
        }
        
        function updateSalaryDisplay(payroll) {
            // Update salary cards
            document.getElementById('grossSalary').textContent = 
                `$${((payroll.basicSalary || 0) + (payroll.totalAllowances || 0)).toLocaleString('en-US', { 
                    minimumFractionDigits: 2, 
                    maximumFractionDigits: 2 
                })}`;
            
            document.getElementById('netSalary').textContent = 
                `$${(payroll.netSalary || 0).toLocaleString('en-US', { 
                    minimumFractionDigits: 2, 
                    maximumFractionDigits: 2 
                })}`;
            
            if (payroll.paymentDate) {
                const date = new Date(payroll.paymentDate);
                document.getElementById('paymentDate').textContent = 
                    date.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
            }
            
            // Update salary breakdown
            document.getElementById('basicSalary').textContent = 
                `$${(payroll.basicSalary || 0).toLocaleString('en-US', { 
                    minimumFractionDigits: 2, 
                    maximumFractionDigits: 2 
                })}`;
            
            document.getElementById('totalEarnings').textContent = 
                `$${((payroll.basicSalary || 0) + (payroll.totalAllowances || 0)).toLocaleString('en-US', { 
                    minimumFractionDigits: 2, 
                    maximumFractionDigits: 2 
                })}`;
            
            document.getElementById('totalDeductions').textContent = 
                `$${(payroll.totalDeductions || 0).toLocaleString('en-US', { 
                    minimumFractionDigits: 2, 
                    maximumFractionDigits: 2 
                })}`;
            
            document.getElementById('finalNetSalary').textContent = 
                `$${(payroll.netSalary || 0).toLocaleString('en-US', { 
                    minimumFractionDigits: 2, 
                    maximumFractionDigits: 2 
                })}`;
        }
        
        function populateSalaryHistory(salaryData) {
            const tbody = document.getElementById('salaryHistory');
            tbody.innerHTML = '';
            
            salaryData.slice(0, 6).forEach(payroll => {
                const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                                  'July', 'August', 'September', 'October', 'November', 'December'];
                const monthName = monthNames[payroll.month - 1];
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${monthName} ${payroll.year}</td>
                    <td>$${(payroll.basicSalary || 0).toLocaleString()}</td>
                    <td>$${(payroll.totalAllowances || 0).toLocaleString()}</td>
                    <td>$${(payroll.totalDeductions || 0).toLocaleString()}</td>
                    <td>$${(payroll.netSalary || 0).toLocaleString()}</td>
                    <td>
                        <span class="status-badge ${payroll.paymentStatus === 'paid' ? 'active' : 'pending'}">
                            ${payroll.paymentStatus === 'paid' ? 'Paid' : '
