<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leave Management - HR Management System</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/admin-dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <i class="fas fa-users"></i>
                <h2>HRMS</h2>
            </div>
            
            <div class="user-info">
                <div class="avatar">
                    <i class="fas fa-user" id="avatarIcon"></i>
                </div>
                <h3 id="userName">Employee Name</h3>
                <p id="userRole">Employee</p>
                <p id="userEmpId">EMP001</p>
            </div>
            
            <nav class="sidebar-nav">
                <a href="employee-dashboard.html">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </a>
                <a href="employee-profile.html">
                    <i class="fas fa-user"></i> My Profile
                </a>
                <a href="attendance.html">
                    <i class="fas fa-calendar-check"></i> Attendance
                </a>
                <a href="leave.html" class="active">
                    <i class="fas fa-calendar-alt"></i> Leave Management
                </a>
                <a href="payroll.html">
                    <i class="fas fa-file-invoice-dollar"></i> Payroll
                </a>
                <a href="#" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </a>
            </nav>
        </aside>
        
        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <h1>Leave Management</h1>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="openApplyLeaveModal()">
                        <i class="fas fa-plus"></i> Apply for Leave
                    </button>
                    <button class="btn btn-secondary" onclick="refreshLeaves()">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
            </header>
            
            <!-- Leave Balance -->
            <div class="leave-balance-section">
                <h2>Your Leave Balance</h2>
                <div class="balance-cards">
                    <div class="balance-card">
                        <div class="balance-icon paid">
                            <i class="fas fa-umbrella-beach"></i>
                        </div>
                        <div class="balance-info">
                            <h3>Paid Leave</h3>
                            <p id="paidBalance">15 days</p>
                            <small>Annual entitlement: 20 days</small>
                        </div>
                    </div>
                    
                    <div class="balance-card">
                        <div class="balance-icon sick">
                            <i class="fas fa-heartbeat"></i>
                        </div>
                        <div class="balance-info">
                            <h3>Sick Leave</h3>
                            <p id="sickBalance">10 days</p>
                            <small>Annual entitlement: 12 days</small>
                        </div>
                    </div>
                    
                    <div class="balance-card">
                        <div class="balance-icon unpaid">
                            <i class="fas fa-calendar-minus"></i>
                        </div>
                        <div class="balance-info">
                            <h3>Unpaid Leave</h3>
                            <p id="unpaidBalance">Unlimited</p>
                            <small>Subject to approval</small>
                        </div>
                    </div>
                    
                    <div class="balance-card">
                        <div class="balance-icon total">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <div class="balance-info">
                            <h3>Total Available</h3>
                            <p id="totalBalance">25 days</p>
                            <small>For this year</small>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Leave Tabs -->
            <div class="leave-tabs">
                <button class="tab-btn active" data-tab="pending">Pending Requests</button>
                <button class="tab-btn" data-tab="approved">Approved</button>
                <button class="tab-btn" data-tab="rejected">Rejected</button>
                <button class="tab-btn" data-tab="history">All History</button>
            </div>
            
            <!-- Pending Requests Tab -->
            <div id="pendingTab" class="tab-content active">
                <div class="section">
                    <div class="section-header">
                        <h2>Pending Leave Requests</h2>
                        <div class="section-actions">
                            <button class="btn btn-outline" onclick="withdrawSelected()">
                                <i class="fas fa-trash"></i> Withdraw Selected
                            </button>
                        </div>
                    </div>
                    
                    <div class="leave-requests-list" id="pendingLeaves">
                        <!-- Pending leaves will be loaded here -->
                    </div>
                    
                    <div class="empty-state" id="noPendingLeaves">
                        <i class="fas fa-inbox"></i>
                        <h3>No Pending Requests</h3>
                        <p>You don't have any pending leave requests.</p>
                        <button class="btn btn-primary" onclick="openApplyLeaveModal()">
                            <i class="fas fa-plus"></i> Apply for Leave
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Approved Tab -->
            <div id="approvedTab" class="tab-content">
                <div class="section">
                    <div class="section-header">
                        <h2>Approved Leaves</h2>
                    </div>
                    
                    <div class="leave-requests-list" id="approvedLeaves">
                        <!-- Approved leaves will be loaded here -->
                    </div>
                    
                    <div class="empty-state" id="noApprovedLeaves">
                        <i class="fas fa-check-circle"></i>
                        <h3>No Approved Leaves</h3>
                        <p>You don't have any approved leaves.</p>
                    </div>
                </div>
            </div>
            
            <!-- Rejected Tab -->
            <div id="rejectedTab" class="tab-content">
                <div class="section">
                    <div class="section-header">
                        <h2>Rejected Leaves</h2>
                    </div>
                    
                    <div class="leave-requests-list" id="rejectedLeaves">
                        <!-- Rejected leaves will be loaded here -->
                    </div>
                    
                    <div class="empty-state" id="noRejectedLeaves">
                        <i class="fas fa-times-circle"></i>
                        <h3>No Rejected Leaves</h3>
                        <p>You don't have any rejected leaves.</p>
                    </div>
                </div>
            </div>
            
            <!-- History Tab -->
            <div id="historyTab" class="tab-content">
                <div class="section">
                    <div class="section-header">
                        <h2>Leave History</h2>
                        <div class="filter-controls">
                            <input type="text" id="historyDateRange" placeholder="Select date range">
                            <select id="historyLeaveType">
                                <option value="">All Types</option>
                                <option value="paid">Paid Leave</option>
                                <option value="sick">Sick Leave</option>
                                <option value="unpaid">Unpaid Leave</option>
                            </select>
                            <button class="btn btn-primary" onclick="filterHistory()">
                                <i class="fas fa-filter"></i> Filter
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Leave Type</th>
                                    <th>Start Date</th>
                                    <th>End Date</th>
                                    <th>Duration</th>
                                    <th>Applied On</th>
                                    <th>Status</th>
                                    <th>Remarks</th>
                                    <th>Admin Comments</th>
                                </tr>
                            </thead>
                            <tbody id="leaveHistory">
                                <!-- History will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="pagination">
                        <button class="btn btn-outline" id="prevHistoryPage" disabled>Previous</button>
                        <span id="historyPageInfo">Page 1 of 1</span>
                        <button class="btn btn-outline" id="nextHistoryPage" disabled>Next</button>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Apply Leave Modal -->
    <div id="applyLeaveModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Apply for Leave</h2>
                <button class="modal-close" onclick="closeApplyModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="applyLeaveForm">
                    <div class="form-group">
                        <label for="leaveType">Leave Type *</label>
                        <select id="leaveType" required>
                            <option value="">Select leave type</option>
                            <option value="paid">Paid Leave</option>
                            <option value="sick">Sick Leave</option>
                            <option value="unpaid">Unpaid Leave</option>
                        </select>
                        <small class="form-hint" id="leaveTypeHint"></small>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="startDate">Start Date *</label>
                            <input type="date" id="startDate" required>
                        </div>
                        <div class="form-group">
                            <label for="endDate">End Date *</label>
                            <input type="date" id="endDate" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Duration</label>
                        <div class="duration-display">
                            <span id="leaveDuration">0 days</span>
                            <small id="workingDays">(0 working days)</small>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="leaveRemarks">Remarks</label>
                        <textarea id="leaveRemarks" rows="3" 
                                  placeholder="Please provide a reason for your leave..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <div class="emergency-checkbox">
                            <input type="checkbox" id="emergencyLeave">
                            <label for="emergencyLeave">
                                This is an emergency leave request
                                <small>(Will be marked as high priority)</small>
                            </label>
                        </div>
                    </div>
                    
                    <div class="balance-warning" id="balanceWarning" style="display: none;">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p id="warningMessage"></p>
                    </div>
                    
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="closeApplyModal()">
                            Cancel
                        </button>
                        <button type="submit" class="btn btn-primary">
                            Submit Leave Request
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- View Leave Details Modal -->
    <div id="viewLeaveModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Leave Request Details</h2>
                <button class="modal-close" onclick="closeViewModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="leave-details">
                    <div class="detail-row">
                        <div class="detail-item">
                            <label>Request ID</label>
                            <p id="detailId">-</p>
                        </div>
                        <div class="detail-item">
                            <label>Status</label>
                            <span id="detailStatus" class="status-badge">Pending</span>
                        </div>
                    </div>
                    
                    <div class="detail-row">
                        <div class="detail-item">
                            <label>Leave Type</label>
                            <p id="detailType">-</p>
                        </div>
                        <div class="detail-item">
                            <label>Duration</label>
                            <p id="detailDuration">-</p>
                        </div>
                    </div>
                    
                    <div class="detail-row">
                        <div class="detail-item">
                            <label>Start Date</label>
                            <p id="detailStartDate">-</p>
                        </div>
                        <div class="detail-item">
                            <label>End Date</label>
                            <p id="detailEndDate">-</p>
                        </div>
                    </div>
                    
                    <div class="detail-row">
                        <div class="detail-item">
                            <label>Applied On</label>
                            <p id="detailAppliedDate">-</p>
                        </div>
                        <div class="detail-item">
                            <label>Reviewed On</label>
                            <p id="detailReviewedDate">-</p>
                        </div>
                    </div>
                    
                    <div class="detail-row full-width">
                        <div class="detail-item">
                            <label>Remarks</label>
                            <p id="detailRemarks">-</p>
                        </div>
                    </div>
                    
                    <div class="detail-row full-width" id="adminCommentsSection" style="display: none;">
                        <div class="detail-item">
                            <label>Admin Comments</label>
                            <p id="detailAdminComments">-</p>
                        </div>
                    </div>
                    
                    <div class="detail-row full-width" id="reviewedBySection" style="display: none;">
                        <div class="detail-item">
                            <label>Reviewed By</label>
                            <p id="detailReviewedBy">-</p>
                        </div>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeViewModal()">
                        Close
                    </button>
                    <button type="button" class="btn btn-danger" id="withdrawBtn" style="display: none;">
                        Withdraw Request
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="js/auth.js"></script>
    <script src="js/leave.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            initLeavePage();
        });
    </script>
</body>
</html>
